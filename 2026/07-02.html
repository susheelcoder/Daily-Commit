<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto WebRTC Call</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  text-align:center;
  padding:15px;
}
video{
  width:45%;
  background:#000;
  border-radius:10px;
}
.videos{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:15px;
}
.status{
  margin-top:10px;
  font-weight:bold;
}
</style>
</head>
<body>

<h2>ðŸŽ¥ Auto Start Video Call</h2>
<p>Do alag device par open karo</p>
<div class="status" id="status">Connecting...</div>

<div class="videos">
  <video id="localVideo" autoplay muted playsinline></video>
  <video id="remoteVideo" autoplay playsinline></video>
</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG (APNA DALO) */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ðŸ”— WebRTC */
const pc = new RTCPeerConnection({
  iceServers:[{urls:"stun:stun.l.google.com:19302"}]
});

const roomId = "auto-room-1";
const roomRef = db.ref(roomId);

const localVideo = document.getElementById("localVideo");
const remoteVideo = document.getElementById("remoteVideo");
const statusEl = document.getElementById("status");

/* ðŸŽ¤ Camera + Mic */
navigator.mediaDevices.getUserMedia({video:true,audio:true})
.then(stream=>{
  localVideo.srcObject = stream;
  stream.getTracks().forEach(track=>pc.addTrack(track,stream));
  autoStart();
})
.catch(()=>alert("Camera/Mic allow karo"));

pc.ontrack = e=>{
  remoteVideo.srcObject = e.streams[0];
};

pc.onicecandidate = e=>{
  if(e.candidate){
    roomRef.child("candidates").push(e.candidate.toJSON());
  }
};

/* ðŸ¤– AUTO START LOGIC */
async function autoStart(){
  const snap = await roomRef.child("offer").get();

  if(!snap.exists()){
    // ðŸ‘¤ FIRST USER â†’ CALLER
    statusEl.innerText = "Waiting for another user...";
    await roomRef.remove(); // clear old data
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    await roomRef.child("offer").set(offer);
  }else{
    // ðŸ‘¤ SECOND USER â†’ JOINER
    statusEl.innerText = "Connecting...";
    await pc.setRemoteDescription(new RTCSessionDescription(snap.val()));
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    await roomRef.child("answer").set(answer);
  }
}

/* ðŸ” ANSWER LISTENER */
roomRef.child("answer").on("value", snap=>{
  if(snap.exists() && !pc.currentRemoteDescription){
    pc.setRemoteDescription(new RTCSessionDescription(snap.val()));
    statusEl.innerText = "Connected âœ…";
  }
});

/* â„ ICE LISTENER */
roomRef.child("candidates").on("child_added", snap=>{
  pc.addIceCandidate(new RTCIceCandidate(snap.val()));
});
</script>

</body>
</html>