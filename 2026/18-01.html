<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Smart Timer v5.3</title>

    <meta name="theme-color" content="#0a0c10">
    <link rel="manifest" id="manifestLink">

    <style>
        :root { --accent:#00ff9d; --bg:#0a0c10; --text:#fff; --card:#1a1d23; }
        body.theme-0{--bg:#0a0c10;--accent:#00ff9d;--card:#1a1d23;}
        body.theme-1{--bg:#001219;--accent:#00d4ff;--card:#002533;}
        body.theme-2{--bg:#1a001a;--accent:#ff00ff;--card:#2d002d;}
        body.theme-3{--bg:#000;--accent:#fff;--card:#111;}
        body.theme-4{--bg:#1b1b1b;--accent:#ffaa00;--card:#2a2a2a;}

        *{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,sans-serif}
        body{
            height:100vh;width:100vw;background:var(--bg);
            display:flex;flex-direction:column;
            justify-content:center;align-items:center;
            color:var(--text);overflow:hidden
        }

        body.minimal-ui .top-nav,
        body.minimal-ui .controls-ui,
        body.minimal-ui .lap-box{display:none!important}

        .top-nav{position:absolute;top:15px;right:15px}
        .menu-btn{background:var(--card);border:1px solid #444;border-radius:50%;padding:10px}

        .dropdown{
            position:absolute;top:45px;right:0;
            background:var(--card);border:1px solid #444;
            border-radius:12px;display:none;
            flex-direction:column;width:190px
        }
        .dropdown button{
            background:none;color:#fff;padding:12px;
            border:none;border-bottom:1px solid #444;
            text-align:left
        }

        .display{
            font-size:18vw;font-weight:800;
            font-family:Courier New,monospace;
            color:var(--accent);text-align:center;
            cursor:pointer
        }
        body.minimal-ui .display{font-size:25vw}
        .ms{font-size:.4em;opacity:.3}

        .controls-ui{
            background:var(--card);padding:25px;
            border-radius:25px;border:1px solid #444;
            width:90%;max-width:400px;margin-top:20px
        }

        input{
            width:100%;padding:12px;font-size:1.6rem;
            text-align:center;border-radius:12px;
            border:1px solid var(--accent);
            background:rgba(0,0,0,.3);color:var(--accent)
        }

        .main-btns{
            margin-top:15px;
            display:grid;grid-template-columns:1fr 1fr;
            gap:12px
        }
        .start-btn{grid-column:span 2;padding:18px;border:none;border-radius:15px;font-weight:bold}
        .reset-btn,.lap-btn{padding:15px;border:none;border-radius:15px;color:#fff}
        .reset-btn{background:#3d444d}
        .lap-btn{background:#1f6feb}

        .lap-box{
            width:90%;max-width:400px;
            max-height:120px;overflow:auto;
            margin-top:10px;font-size:.85rem;
            opacity:.85
        }
        .lap-box div{border-bottom:1px dashed #444;padding:4px}
    </style>
</head>

<body class="theme-0" ondblclick="toggleModes()">

<div class="top-nav">
    <button class="menu-btn" onclick="toggleMenu(event)">‚ò∞</button>
    <div class="dropdown" id="menuBox">
        <button onclick="changeTheme()">üé® Switch Theme</button>
        <button onclick="shareApp()">üîó Share App</button>
        <button onclick="checkUpdate()">üîÑ Update App</button>
        <button onclick="showAbout()">‚ÑπÔ∏è About App</button>
        <button onclick="resetAll()">üîÑ Full Reset</button>
    </div>
</div>

<div class="display" onclick="handleDisplayClick(event)">
    <span id="timeDisplay">00:00:00</span><br>
    <span class="ms">.<span id="msDisplay">000</span></span>
</div>

<div class="controls-ui">
    <input type="text" id="timeInput" value="00:00:00">
    <div class="main-btns">
        <button class="start-btn" id="startBtn" onclick="startTimer(event)">START</button>
        <button class="reset-btn" onclick="resetAll()">RESET</button>
        <button class="lap-btn" onclick="addLap()">LAP</button>
    </div>
</div>

<div class="lap-box" id="lapBox"></div>

<script>
const APP_VERSION="5.3";
let timer,running=false,totalMs=0,isMinimal=false;
let currentTheme=0,lapCount=0;

function showAbout(){
 alert("Pro Smart Timer v"+APP_VERSION+"\n\nNew in v5.3:\n‚úî Lap History\n‚úî New App Icon");
}

function toggleMenu(e){
 e.stopPropagation();
 const m=document.getElementById("menuBox");
 m.style.display=m.style.display==="flex"?"none":"flex";
}
window.onclick=()=>menuBox.style.display="none";

function toggleModes(){
 isMinimal=!isMinimal;
 document.body.classList.toggle("minimal-ui",isMinimal);
}

function handleDisplayClick(e){
 e.stopPropagation();
 running?stopTimer():startTimer();
}

function format(ms){
 let s=Math.floor(ms/1000);
 let h=Math.floor(s/3600);
 let m=Math.floor((s%3600)/60);
 let sec=s%60;
 let milli=ms%1000;
 timeDisplay.textContent=
 `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
 msDisplay.textContent=String(milli).padStart(3,"0");
}

function startTimer(e){
 if(running){stopTimer();return;}
 if(e)e.stopPropagation();
 let p=timeInput.value.split(":").map(Number);
 let input=((p[0]||0)*3600+(p[1]||0)*60+(p[2]||0))*1000;
 let mode=(input>0&&totalMs===0)?"down":"up";
 if(mode==="down")totalMs=input;
 running=true;
 startBtn.textContent="STOP";
 startBtn.style.background="#ff4d4d";
 timer=setInterval(()=>{
   if(mode==="up")totalMs+=10;
   else{totalMs-=10;if(totalMs<=0){totalMs=0;stopTimer();}}
   format(totalMs);
 },10);
}

function stopTimer(){
 clearInterval(timer);
 running=false;
 startBtn.textContent="START";
 startBtn.style.background="var(--accent)";
}

function resetAll(){
 stopTimer();totalMs=0;lapCount=0;
 lapBox.innerHTML="";
 format(0);
 timeInput.value="00:00:00";
}

function addLap(){
 if(!running)return;
 lapCount++;
 const d=document.createElement("div");
 d.textContent=`Lap ${lapCount} ‚Üí ${timeDisplay.textContent}.${msDisplay.textContent}`;
 lapBox.prepend(d);
}

function changeTheme(){
 currentTheme=(currentTheme+1)%5;
 document.body.className=`theme-${currentTheme}`;
}

function shareApp(){
 if(navigator.share)navigator.share({title:"Timer Pro",url:location.href});
}

/* Manifest with NEW ICON */
const manifest={
 name:"Pro Smart Timer",
 short_name:"Timer Pro",
 start_url:".",
 display:"standalone",
 background_color:"#0a0c10",
 theme_color:"#00ff9d",
 icons:[{
   src:"https://img.icons8.com/fluency/512/stopwatch.png",
   sizes:"512x512",
   type:"image/png"
 }]
};
const blob=new Blob([JSON.stringify(manifest)],{type:"application/json"});
manifestLink.href=URL.createObjectURL(blob);
</script>
</body>
</html>