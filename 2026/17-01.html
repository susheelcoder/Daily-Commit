<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Timer</title>

<!-- ðŸ”¹ INLINE MANIFEST (PWA) -->
<link rel="manifest" id="manifestLink">

<meta name="theme-color" content="#203a43">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:Poppins, sans-serif;
}

body{
    height:100vh;
    overflow:hidden;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
}

.card{
    width:360px;
    padding:35px;
    border-radius:22px;
    background:rgba(255,255,255,0.12);
    backdrop-filter:blur(16px);
    box-shadow:0 30px 60px rgba(0,0,0,0.5);
    text-align:center;
}

h1{
    margin-bottom:15px;
    letter-spacing:1px;
}

input{
    width:210px;
    padding:12px;
    font-size:1.2rem;
    text-align:center;
    border:none;
    border-radius:14px;
    outline:none;
    margin-bottom:20px;
    background:rgba(255,255,255,0.2);
    color:#fff;
}

.display{
    font-size:2.7rem;
    font-weight:700;
    margin-bottom:25px;
}

.ms{
    font-size:1.1rem;
    opacity:0.8;
}

.buttons{
    display:flex;
    gap:12px;
    justify-content:center;
}

button{
    padding:12px 22px;
    border:none;
    border-radius:25px;
    font-weight:600;
    cursor:pointer;
    transition:.3s;
}

.start{background:#00ff9d;color:#000;}
.stop{background:#ff4d4d;color:#fff;}
.reset{background:#ffd633;color:#000;}

button:hover{
    transform:scale(1.1);
    box-shadow:0 0 15px rgba(255,255,255,0.4);
}
</style>
</head>

<body>

<div class="card">
    <h1>SMART TIMER</h1>

    <input type="text" id="timeInput" value="00:00:00">

    <div class="display">
        <span id="time">00:00:00</span>
        <span class="ms">.<span id="ms">000</span></span>
    </div>

    <div class="buttons">
        <button class="start" onclick="startTimer()">Start</button>
        <button class="stop" onclick="stopTimer()">Stop</button>
        <button class="reset" onclick="resetTimer()">Restart</button>
    </div>
</div>

<script>
/* =========================
   ðŸ”” MULTIPLE BEEPS (3x)
========================= */
function playMultipleBeeps(times = 3){
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    let count = 0;

    function beep(){
        if(count >= times) return;
        count++;

        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        osc.frequency.value = 900;
        gain.gain.value = 0.4;

        osc.connect(gain);
        gain.connect(ctx.destination);

        osc.start();
        osc.stop(ctx.currentTime + 0.25);

        setTimeout(beep, 400);
    }
    beep();
}

/* =========================
   â± TIMER LOGIC
========================= */
let timer, running=false, mode="up", totalMs=0;

function format(ms){
    let s = Math.floor(ms/1000);
    let h = Math.floor(s/3600);
    let m = Math.floor((s%3600)/60);
    let sec = s%60;
    let milli = ms%1000;

    time.innerText =
        `${String(h).padStart(2,'0')}:`+
        `${String(m).padStart(2,'0')}:`+
        `${String(sec).padStart(2,'0')}`;
    document.getElementById("ms").innerText =
        String(milli).padStart(3,'0');
}

function parseInput(v){
    let p = v.split(":").map(Number);
    if(p.length!==3) return 0;
    return (p[0]*3600+p[1]*60+p[2])*1000;
}

function startTimer(){
    if(running) return;

    let parsed = parseInput(timeInput.value);
    if(parsed > 0){
        totalMs = parsed;
        mode = "down";
    }else{
        totalMs = totalMs || 0;
        mode = "up";
    }

    running = true;
    timer = setInterval(()=>{
        if(mode==="up"){
            totalMs += 10;
        }else{
            if(totalMs <= 0){
                stopTimer();
                playMultipleBeeps(3); // ðŸ””ðŸ””ðŸ””
                return;
            }
            totalMs -= 10;
        }
        format(totalMs);
    },10);
}

function stopTimer(){
    clearInterval(timer);
    running=false;
}

function resetTimer(){
    stopTimer();
    totalMs=0;
    format(0);
    timeInput.value="00:00:00";
}

/* =========================
   ðŸ“² INLINE PWA (NO FILES)
========================= */
const manifest = {
    name: "Smart Timer",
    short_name: "Timer",
    start_url: ".",
    display: "standalone",
    background_color: "#0f2027",
    theme_color: "#203a43"
};

const manifestBlob = new Blob(
    [JSON.stringify(manifest)],
    { type: "application/json" }
);
document.getElementById("manifestLink").href =
    URL.createObjectURL(manifestBlob);

/* SERVICE WORKER (INLINE) */
if ("serviceWorker" in navigator) {
    const swCode = `
        self.addEventListener('install', e => self.skipWaiting());
        self.addEventListener('fetch', e => {});
    `;
    const swBlob = new Blob([swCode], { type: "text/javascript" });
    const swUrl = URL.createObjectURL(swBlob);
    navigator.serviceWorker.register(swUrl);
}
</script>

</body>
</html>