<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Timer Pro</title>

<link rel="manifest" id="manifestLink">
<meta name="theme-color" content="#0f2027">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}

body{
    height:100vh;
    overflow:hidden;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    display:flex;
    justify-content:center;
    align-items:center;
    color:#fff;
}

.card{
    width:370px;
    padding:30px;
    border-radius:22px;
    background:rgba(255,255,255,0.12);
    backdrop-filter:blur(18px);
    box-shadow:0 30px 60px rgba(0,0,0,.6);
    text-align:center;
}

h1{margin-bottom:10px;letter-spacing:1px}

input[type="text"]{
    width:210px;
    padding:10px;
    font-size:1.1rem;
    border:none;
    border-radius:12px;
    text-align:center;
    background:rgba(255,255,255,.25);
    color:#fff;
    margin-bottom:12px;
}

.display{
    font-size:2.4rem;
    font-weight:700;
    margin:15px 0;
}

.ms{font-size:1rem;opacity:.7}

.buttons{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:center;
}

button{
    padding:10px 18px;
    border:none;
    border-radius:20px;
    font-weight:600;
    cursor:pointer;
    transition:.3s;
}

.start{background:#00ff9d}
.stop{background:#ff4d4d;color:#fff}
.reset{background:#ffd633}
.lap{background:#00c6ff}
.full{background:#9dff00}

button:hover{transform:scale(1.08)}

.records{
    margin-top:12px;
    max-height:110px;
    overflow:auto;
    text-align:left;
    font-size:.85rem;
    background:rgba(0,0,0,.25);
    border-radius:10px;
    padding:8px;
}

.records div{border-bottom:1px solid rgba(255,255,255,.2);padding:4px}

input[type="file"]{
    margin-top:8px;
    color:#fff;
    font-size:.8rem;
}
</style>
</head>

<body>

<div class="card">
<h1>SMART TIMER PRO</h1>

<input type="text" id="timeInput" value="00:00:00">

<div class="display">
<span id="time">00:00:00</span><span class="ms">.<span id="ms">000</span></span>
</div>

<div class="buttons">
<button class="start" onclick="startTimer()">Start</button>
<button class="stop" onclick="stopTimer()">Stop</button>
<button class="reset" onclick="resetTimer()">Reset</button>
<button class="lap" onclick="addLap()">Lap</button>
<button class="full" onclick="goFull()">Full</button>
</div>

<input type="file" accept="audio/*" onchange="loadSound(this)">
<div class="records" id="laps"></div>
</div>

<script>
/* ===== TIMER ===== */
let timer,running=false,mode="up",totalMs=0;
let alarmAudio=null;

function format(ms){
 let s=Math.floor(ms/1000);
 let h=Math.floor(s/3600);
 let m=Math.floor((s%3600)/60);
 let sec=s%60;
 let milli=ms%1000;
 time.textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
 msEl.textContent=String(milli).padStart(3,'0');
}
const msEl=document.getElementById("ms");

function parse(v){
 let p=v.split(":").map(Number);
 return p.length===3?(p[0]*3600+p[1]*60+p[2])*1000:0;
}

function startTimer(){
 if(running) return;
 let p=parse(timeInput.value);
 if(p>0){totalMs=p;mode="down"} else{mode="up"}
 running=true;
 timer=setInterval(()=>{
   if(mode==="up"){totalMs+=10}
   else{
     if(totalMs<=0){
       stopTimer();
       alarm();
       return;
     }
     totalMs-=10;
   }
   format(totalMs);
 },10);
}

function stopTimer(){clearInterval(timer);running=false}
function resetTimer(){stopTimer();totalMs=0;format(0);timeInput.value="00:00:00"}

/* ===== ALARM ===== */
function alarm(){
 // ðŸ”” sound
 if(alarmAudio){alarmAudio.play()}
 else beep(3);

 // ðŸ“³ vibration
 if(navigator.vibrate) navigator.vibrate([300,200,300,200,300]);
}

function beep(n){
 let ctx=new AudioContext();let i=0;
 function b(){
   if(i++>=n)return;
   let o=ctx.createOscillator(),g=ctx.createGain();
   o.frequency.value=900;g.gain.value=.4;
   o.connect(g);g.connect(ctx.destination);
   o.start();o.stop(ctx.currentTime+.2);
   setTimeout(b,400);
 }
 b();
}

/* ===== CUSTOM SOUND ===== */
function loadSound(input){
 let file=input.files[0];
 if(file) alarmAudio=new Audio(URL.createObjectURL(file));
}

/* ===== LAPS ===== */
function addLap(){
 let d=document.createElement("div");
 d.textContent=time.textContent+"."+msEl.textContent;
 laps.prepend(d);
}

/* ===== FULLSCREEN KIOSK ===== */
function goFull(){
 if(document.documentElement.requestFullscreen)
   document.documentElement.requestFullscreen();
}

/* ===== PWA INLINE ===== */
const manifest={
 name:"Smart Timer Pro",
 short_name:"Timer",
 start_url:".",
 display:"standalone",
 theme_color:"#0f2027",
 background_color:"#0f2027"
};
const blob=new Blob([JSON.stringify(manifest)],{type:"application/json"});
manifestLink.href=URL.createObjectURL(blob);

if("serviceWorker"in navigator){
 let sw=new Blob([`self.addEventListener('fetch',e=>{})`],{type:"text/js"});
 navigator.serviceWorker.register(URL.createObjectURL(sw));
}
</script>

</body>
</html>