<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>AI Video - Final Fixed</title>
    <script src="https://cdn.jsdelivr.net/npm/@fal-ai/serverless-client@0.14.3/dist/index.browser.js"></script>
    <style>
        :root { --primary: #00f2fe; --bg: #0a0a0c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; padding: 20px; }
        .card { background: #16161a; padding: 30px; border-radius: 20px; width: 100%; max-width: 450px; text-align: center; border: 1px solid #333; }
        .upload-zone { border: 2px dashed #444; padding: 30px; border-radius: 15px; cursor: pointer; margin-bottom: 20px; }
        #imageUrlOutput { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #000; color: var(--primary); font-size: 11px; }
        .btn-gen { width: 100%; background: var(--primary); color: #000; border: none; padding: 14px; border-radius: 12px; font-weight: bold; cursor: pointer; }
        #status { color: #00f2fe; margin: 15px 0; font-size: 14px; font-weight: bold; }
        video { width: 100%; border-radius: 12px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>üé¨ AI Video Generator</h2>
    
    <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
        <span id="labelText">üìÅ Tap to Upload Photo</span>
    </div>
    <input type="file" id="fileInput" hidden accept="image/*" onchange="uploadFixed(this.files[0])">

    <div id="status">Taiyar rahein...</div>
    <input type="text" id="imageUrlOutput" placeholder="Public URL yahan dikhega..." readonly>
    
    <button class="btn-gen" id="genBtn" onclick="generateVideo()">Create AI Video</button>

    <video id="finalVideo" controls autoplay loop></video>
</div>

<script>
    // Aapki API Key
    const API_KEY = "C5952036-e030-4e09-af40-fde35b647d91:dbf537440b309a29ec17b45d60975b98";
    
    // SDK Setup
    const fal = window.fal;
    fal.config({ proxyUrl: null, credentials: API_KEY });

    async function uploadFixed(file) {
        if (!file) return;
        const status = document.getElementById('status');
        const urlInput = document.getElementById('imageUrlOutput');

        status.innerText = "‚è≥ Cloud par upload ho raha hai...";

        try {
            // fal.storage.upload() function file ko automatically handle karta hai
            const url = await fal.storage.upload(file);
            console.log("Upload Success:", url);
            
            urlInput.value = url;
            status.innerText = "‚úÖ URL Connected Successfully!";
        } catch (err) {
            console.error(err);
            status.innerText = "‚ùå Upload Fail: " + err.message;
        }
    }

    async function generateVideo() {
        const url = document.getElementById('imageUrlOutput').value;
        if (!url || url.includes("...")) return alert("Pehle upload hone dein!");

        const status = document.getElementById('status');
        status.innerText = "üé¨ AI Processing (Video ban rahi hai)...";

        try {
            const result = await fal.subscribe("fal-ai/kling-video/v1.5/standard/image-to-video", {
                input: {
                    image_url: url,
                    prompt: "smooth cinematic motion, high definition"
                },
                pollInterval: 5000,
                logs: true
            });

            if (result.video) {
                const v = document.getElementById('finalVideo');
                v.src = result.video.url;
                v.style.display = "block";
                status.innerText = "‚úÖ Done!";
            }
        } catch (e) {
            alert("Error: " + e.message);
            status.innerText = "‚ùå Error in Video API";
        }
    }
</script>

</body>
</html>
