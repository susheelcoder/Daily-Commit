<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>AI Image to URL Form</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 40px; text-align: center; }
        .form-container { background: #1e1e1e; padding: 25px; border-radius: 15px; max-width: 500px; margin: auto; border: 1px solid #333; }
        input[type="text"] { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #444; background: #000; color: #00f2fe; box-sizing: border-box; }
        .upload-area { border: 2px dashed #00f2fe; padding: 20px; cursor: pointer; margin-bottom: 20px; border-radius: 10px; }
        .loader { display: none; color: #ffeb3b; font-size: 14px; margin-bottom: 10px; }
        label { display: block; text-align: left; margin-top: 10px; color: #ccc; }
        button { background: #00f2fe; color: black; border: none; padding: 12px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div class="form-container">
    <h2>üîó Image to URL Connector</h2>
    
    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <span id="uploadLabel">Photo select karein</span>
        <input type="file" id="fileInput" hidden accept="image/*" onchange="uploadAndGetUrl(event)">
    </div>

    <div id="loader" class="loader">‚öôÔ∏è URL generate ho raha hai...</div>

    <form id="mainForm">
        <label>Image Ka Seedha URL (Auto-filled):</label>
        <input type="text" id="imageUrlOutput" name="image_url" placeholder="Yahan URL apne aap aayega..." readonly>
        
        <label>Video Prompt:</label>
        <input type="text" id="prompt" placeholder="Ex: cinematic motion, wave effect">
        
        <button type="button" onclick="generateVideoNow()">Video Generate Karein</button>
    </form>

    <div id="videoContainer">
        <video id="finalVideo" controls style="width:100%; margin-top:20px; display:none; border-radius:10px;"></video>
    </div>
</div>

<script>
    const API_KEY = "C5952036-e030-4e09-af40-fde35b647d91:dbf537440b309a29ec17b45d60975b98";

    // Step 1: Photo upload karke URL field mein bharna
    async function uploadAndGetUrl(event) {
        const file = event.target.files[0];
        if (!file) return;

        const loader = document.getElementById('loader');
        const urlInput = document.getElementById('imageUrlOutput');
        const uploadLabel = document.getElementById('uploadLabel');

        loader.style.display = "block";
        uploadLabel.innerText = "Uploading: " + file.name;

        try {
            const response = await fetch('https://rest.alpha.fal.ai/storage/upload', {
                method: 'POST',
                headers: { 'Authorization': `Key ${API_KEY}` },
                body: file
            });
            const data = await response.json();
            
            // YAHAN CONNECT HO RAHA HAI: File ka URL input box mein daal diya
            urlInput.value = data.url; 
            loader.style.display = "none";
            uploadLabel.innerText = "‚úÖ Upload Successful!";
        } catch (err) {
            alert("Upload failed!");
            loader.style.display = "none";
        }
    }

    // Step 2: Form ke URL ko use karke video banana
    async function generateVideoNow() {
        const videoUrl = document.getElementById('imageUrlOutput').value;
        const promptText = document.getElementById('prompt').value || "natural movement";

        if (!videoUrl) {
            alert("Pehle photo upload hone dein!");
            return;
        }

        document.getElementById('loader').innerText = "üé• AI Video process kar raha hai...";
        document.getElementById('loader').style.display = "block";

        try {
            const res = await fetch('https://queue.fal.run/fal-ai/kling-video/v1.5/standard/image-to-video', {
                method: 'POST',
                headers: {
                    'Authorization': `Key ${API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    image_url: videoUrl,
                    prompt: promptText
                })
            });
            const data = await res.json();
            pollStatus(data.request_id);
        } catch (err) {
            alert("Error!");
        }
    }

    async function pollStatus(requestId) {
        const timer = setInterval(async () => {
            const res = await fetch(`https://queue.fal.run/fal-ai/kling-video/requests/${requestId}`, {
                headers: { 'Authorization': `Key ${API_KEY}` }
            });
            const result = await res.json();

            if (result.status === "COMPLETED") {
                clearInterval(timer);
                const video = document.getElementById('finalVideo');
                video.src = result.video.url;
                video.style.display = "block";
                document.getElementById('loader').style.display = "none";
            }
        }, 5000);
    }
</script>

</body>
</html>
