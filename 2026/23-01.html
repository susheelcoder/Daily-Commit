<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Generator - Powered by Fal.ai</title>
    <style>
        :root { --primary: #00f2fe; --bg: #0a0a0c; --card: #16161a; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 2.5rem; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.7); width: 100%; max-width: 480px; text-align: center; border: 1px solid #333; }
        h1 { font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--primary); }
        .upload-box { border: 2px dashed #444; padding: 40px 20px; border-radius: 16px; margin: 20px 0; cursor: pointer; transition: 0.3s; }
        .upload-box:hover { border-color: var(--primary); background: rgba(0, 242, 254, 0.05); }
        #imgPreview { width: 100%; border-radius: 12px; display: none; margin-bottom: 15px; }
        .btn { background: var(--primary); color: #000; border: none; padding: 14px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1rem; }
        .btn:disabled { background: #444; color: #888; cursor: not-allowed; }
        #status { margin-top: 15px; font-size: 0.9rem; color: #aaa; display: none; }
        video { width: 100%; border-radius: 12px; margin-top: 20px; display: none; border: 1px solid var(--primary); }
        .spinner { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸŽ¬ Image to AI Video</h1>
    <p style="color: #888;">Photo upload karein aur jaadu dekhein</p>

    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <span id="label">Click to Upload Image</span>
        <img id="imgPreview">
    </div>
    <input type="file" id="fileInput" hidden accept="image/*" onchange="handlePreview(event)">

    <button id="genBtn" class="btn" onclick="generateVideo()">Video Generate Karein</button>

    <div id="status">
        <div class="spinner"></div> <span id="statusText">Processing...</span>
    </div>

    <video id="outputVideo" controls autoplay loop></video>
</div>

<script>
    const API_KEY = "C5952036-e030-4e09-af40-fde35b647d91:dbf537440b309a29ec17b45d60975b98";
    let selectedFile = null;

    function handlePreview(e) {
        selectedFile = e.target.files[0];
        if (selectedFile) {
            const reader = new FileReader();
            reader.onload = (event) => {
                document.getElementById('imgPreview').src = event.target.result;
                document.getElementById('imgPreview').style.display = "block";
                document.getElementById('label').style.display = "none";
            };
            reader.readAsDataURL(selectedFile);
        }
    }

    async function generateVideo() {
        if (!selectedFile) return alert("Pehle ek image select karein!");

        const btn = document.getElementById('genBtn');
        const statusDiv = document.getElementById('status');
        const statusText = document.getElementById('statusText');
        const video = document.getElementById('outputVideo');

        btn.disabled = true;
        statusDiv.style.display = "block";
        video.style.display = "none";

        try {
            // 1. Upload Image to Fal Storage
            statusText.innerText = "Image upload ho rahi hai...";
            const uploadRes = await fetch('https://rest.alpha.fal.ai/storage/upload', {
                method: 'POST',
                headers: { 'Authorization': `Key ${API_KEY}` },
                body: selectedFile
            });
            const uploadData = await uploadRes.json();

            // 2. Start Video Generation (Kling AI Model)
            statusText.innerText = "AI Video bana raha hai (60s tak lag sakte hain)...";
            const response = await fetch('https://queue.fal.run/fal-ai/kling-video/v1.5/standard/image-to-video', {
                method: 'POST',
                headers: {
                    'Authorization': `Key ${API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    image_url: uploadData.url,
                    prompt: "natural smooth motion, cinematic lighting, 4k"
                })
            });
            const queueData = await response.json();
            pollStatus(queueData.request_id);

        } catch (err) {
            alert("Error: " + err.message);
            btn.disabled = false;
            statusDiv.style.display = "none";
        }
    }

    async function pollStatus(requestId) {
        const interval = setInterval(async () => {
            const res = await fetch(`https://queue.fal.run/fal-ai/kling-video/requests/${requestId}`, {
                headers: { 'Authorization': `Key ${API_KEY}` }
            });
            const data = await res.json();

            if (data.status === "COMPLETED") {
                clearInterval(interval);
                document.getElementById('outputVideo').src = data.video.url;
                document.getElementById('outputVideo').style.display = "block";
                document.getElementById('status').style.display = "none";
                document.getElementById('genBtn').disabled = false;
            } else if (data.status === "FAILED") {
                clearInterval(interval);
                alert("Generation failed!");
                document.getElementById('genBtn').disabled = false;
            }
        }, 5000);
    }
</script>

</body>
</html>
